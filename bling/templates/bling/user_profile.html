{% extends "layout/basic.html" %}

{% block title %} {{ blinguser.username }} {% endblock %}

{% block content %}

<!--now rendering this user's name-->
{% if blinguser.first_name or blinguser.lastname %}
        <h1>{{ blinguser.first_name }} {{ blinguser.last_name }}</h1>
    {% else %}
        <h1>{{ blinguser.username }}</h1>
    {% endif %}

<!--now rendering subscribe/unsubscribe button--><br>
{% if request.user != blinguser %}
    <form method="post">{% csrf_token %}

        {% if is_current_user_subscribed %}
            <button name="unsubscribe" type="submit" value="{{ blinguser.pk }}">–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
        {% elif is_current_user_friend %}
            <button name="unsubscribe" type="submit" value="{{ blinguser.pk }}">–£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π</button>
        {% elif is_profile_user_subscribed %}
            <button name="subscribe" type="submit" value="{{ blinguser.pk }}">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –≤ –æ—Ç–≤–µ—Ç</button>
        {% else %}
            <button name="subscribe" type="submit" value="{{ blinguser.pk }}">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
        {% endif %}

    </form>
{% endif %}

<!--subs/friends block-->
<div style="border: 1px solid black; position: relative; width: 500px; background-color: #7777ff;">
    –î—Ä—É–∑—å—è: {{ friends_amount }}
    {% if friends_amount > 0 %}
        {% for friend in friends %}
            <br><a href="{% url 'user_profile' friend.username %}">{{ friend.profile }}</a>
        {% endfor %}
    {% endif %}
</div>
<div style="border: 1px solid black; position: relative; width: 500px; background-color: #7777ff;">
    –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: {{ subs_amount }}
    {% if subs_amount > 0 %}
        {% for sub in subs %}
            <br><a href="{% url 'user_profile' sub.username %}">{{ sub.profile }}</a>
        {% endfor %}
    {% endif %}
</div>

{% if blinguser.pk == user.pk %}<br>
<form method="post">{% csrf_token %}
    <input type="text" name="new_post" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?">
    <button name="post_id" type="submit" value="{{ blingpost.pk }}">–ó–∞–ø–æ—Å—Ç–∏—Ç—å</button>
</form>
{% endif %}
<!--posts block-->
{% for blingpost in blingposts %}
            <div class="post">
                <h3><a href="{% url 'user_profile' blingpost.author.username %}">{{ blingpost.author.profile }}</a> —Å–¥–µ–ª–∞–ª –ø–æ—Å—Ç:</h3>
                <p>{{ blingpost.text }}</p><br>
                {% if blingpost.images != None %}
                    <img src="{{ MEDIA_ROOT }}{{ blingpost.images.image.url }}" width="200px">
                {% endif %}

                <!-- likes & comments block -->
                <h4 class="PostDate">
                        üïô {{ blingpost.how_old }}
                    <form method="post">{% csrf_token %}
                        <button name="like" type="submit" value="{{ blingpost.pk }}">–ù—Ä–∞–≤–∏—Ç—Å—è({{ blingpost.likes_amount }})</button>
                    </form>
                    –ö–æ–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: {{ blingpost.comments_amount }}
                    {% if blingpost.comments_amount > 0 %}
                        {% for comment in blingpost.comments.all %}
                    <br><a href="{% url 'user_profile' comment.author.username %}">{{ comment.author.profile }}</a>: {{ comment }} ({{ comment.how_old }})
                        {% endfor %}
                    {% endif %}
                    <form method="post">{% csrf_token %}
                        <input type="text" name="comment_text" placeholder="–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å...">
                        <button name="post_id" type="submit" value="{{ blingpost.pk }}">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </form>
                </h4>

                <!-- author can delete their post -->
                {% if blinguser.username == user.username %}
                    <form method="post">{% csrf_token %}
                        <button name="remove_post" value="{{ blingpost.pk }}" type="submit">–£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                {% endif %}
            </div><br>
        {% endfor %}
</div><br>
{% endblock %}